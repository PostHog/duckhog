# name: test/sql/queries/projection.test_slow
# description: Column projection and filtering tests via Flight SQL
# group: [queries]

# Tests in this file require a running Flight SQL server
# Run: ./scripts/test-servers.sh start before executing

require duckhog

require-env FLIGHT_HOST

require-env FLIGHT_PORT

require-env DUCKHOG_USER

require-env DUCKHOG_PASSWORD

statement ok
ATTACH 'hog:memory?user=${DUCKHOG_USER}&password=${DUCKHOG_PASSWORD}&flight_server=grpc+tls://${FLIGHT_HOST}:${FLIGHT_PORT}' AS remote;

# Test: Column projection with filter
query I
SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
FROM remote.main.pg_type
WHERE typname IS NOT NULL;
----
1

# Test: Multiple column projection with ordering
query II
SELECT
    CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END,
    CASE WHEN COUNT(typname) > 0 THEN 1 ELSE 0 END
FROM remote.main.pg_type;
----
1	1

# Test: Numeric projection against OID column
query I
SELECT CASE WHEN COUNT(*) >= COUNT(oid) THEN 1 ELSE 0 END
FROM remote.main.pg_type;
----
1
