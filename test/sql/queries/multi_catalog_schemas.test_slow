# name: test/sql/queries/multi_catalog_schemas.test_slow
# description: Test multi-catalog auto-discovery when no database is specified
# group: [queries]

# Tests in this file require a running Flight SQL server
# Run: ./scripts/test-servers.sh start before executing

require posthog

require-env FLIGHT_HOST

require-env FLIGHT_PORT

# When no catalog is specified in the connection string, the extension
# auto-discovers all remote catalogs from the Flight server.
# The test server returns two catalogs: "alt" and "test".
# All discovered catalogs use the prefix pattern: <alias>_<catalog_name>
statement ok
ATTACH 'hog:?token=demo&flight_server=grpc://${FLIGHT_HOST}:${FLIGHT_PORT}' AS remote;

# Verify remote_alt has the 'main' schema
query I
SELECT COUNT(*) FROM information_schema.schemata WHERE catalog_name = 'remote_alt' AND schema_name = 'main';
----
1

# Verify remote_test has the 'main' schema
query I
SELECT COUNT(*) FROM information_schema.schemata WHERE catalog_name = 'remote_test' AND schema_name = 'main';
----
1

# Ensure both catalogs have working table access
query I
SELECT COUNT(*) FROM remote_alt.main.numbers;
----
10

query I
SELECT COUNT(*) FROM remote_test.main.numbers;
----
10
