# name: test/sql/roadmap/rm09_merge_remote.test_slow
# description: Roadmap target RM09 - MERGE INTO remote table
# group: [roadmap]

require duckhog

require-env FLIGHT_HOST

require-env FLIGHT_PORT

require-env DUCKHOG_USER

require-env DUCKHOG_PASSWORD

statement ok
ATTACH 'hog:ducklake?user=${DUCKHOG_USER}&password=${DUCKHOG_PASSWORD}&flight_server=grpc+tls://${FLIGHT_HOST}:${FLIGHT_PORT}&tls_skip_verify=true' AS remote_flight;

statement ok
DROP SCHEMA IF EXISTS remote_flight.roadmap_rm09 CASCADE;

statement ok
CREATE SCHEMA remote_flight.roadmap_rm09;

statement ok
CREATE TABLE remote_flight.roadmap_rm09.tgt(i INT, v INT);

statement ok
CREATE TABLE remote_flight.roadmap_rm09.src(i INT, v INT);

statement ok
MERGE INTO remote_flight.roadmap_rm09.tgt AS t USING remote_flight.roadmap_rm09.src AS s ON t.i = s.i WHEN MATCHED THEN UPDATE SET v = s.v WHEN NOT MATCHED THEN INSERT VALUES (s.i, s.v);
